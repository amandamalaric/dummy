provisionByClaimPolicy:
  Type: AWS::IoT::Policy
  Properties:
    PolicyDocument:
      Version: '2012-10-17'
      Statement:
        - Effect: Allow
          Action:
            - iot:Connect
          Resource:
            - Fn::Join: [ ":", [ "arn", { Ref: "AWS::Partition" }, "iot", { Ref: "AWS::Region" }, { Ref: "AWS::AccountId" }, "client/iot:Connection.Thing.ThingName" ] ]
        - Effect: Allow
          Action:
            - "iot:Publish"
            - "iot:Receive"
          Resource:
            - Fn::Join: [ ":", [ "arn", { Ref: "AWS::Partition" }, "iot", { Ref: "AWS::Region" }, { Ref: "AWS::AccountId" }, "topic/${self:provider.stage}/iot:Connection.Thing.ThingTypeName/iot:Connection.Thing.Attributes[client]}/iot:Connection.Thing.Attributes[city]/iot:Connection.Thing.ThingName/*" ] ]
            - Fn::Join: [ ":", [ "arn", { Ref: "AWS::Partition" }, "iot", { Ref: "AWS::Region" }, { Ref: "AWS::AccountId" }, "topic/$aws/things/iot:Connection.Thing.ThingName/*" ] ]
        - Effect: Allow
          Action:
            - "iot:Subscribe"
          Resource:
            - Fn::Join: [ ":", [ "arn", { Ref: "AWS::Partition" }, "iot", { Ref: "AWS::Region" }, { Ref: "AWS::AccountId" }, "topicfilter/${self:provider.stage}/iot:Connection.Thing.ThingTypeName/iot:Connection.Thing.Attributes[client]/iot:Connection.Thing.Attributes[city]/iot:Connection.Thing.ThingName/*" ] ]
            - Fn::Join: [ ":", [ "arn", { Ref: "AWS::Partition" }, "iot", { Ref: "AWS::Region" }, { Ref: "AWS::AccountId" }, "topicfilter/$aws/things/iot:Connection.Thing.ThingName/*" ] ]
    PolicyName: 'ProvisionByClaimPolicy'